#!/bin/bash

cd webreview-fe && ember build && cd ..
./scripts/test

if [ -d env ]; then
  source env/bin/activate
  if [ $2 ]; then
    gcloud app deploy \
      -q \
      --no-promote \
      --project=$1 \
      --version=$2 \
      app.yaml
  elif [ $1 ]; then
    gcloud app deploy \
      -q \
      --no-promote \
      --project=$1 \
      --version=auto \
      app.yaml
  else
    echo "Usage: ./scripts/deploy <project>"
    exit 1
  fi
  deactivate
else
  echo 'Run ./scripts/setup first.'
  exit 1
fi

